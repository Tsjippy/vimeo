{"version":3,"file":"admin.min.js","mappings":"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","sources":["webpack://vimeo/./admin.js","webpack://vimeo/../../../plugins/sim-plugin/includes/js/partials/show_loader.js"],"sourcesContent":["import {showLoader} from './../../../plugins/sim-plugin/includes/js/partials/show_loader.js';\n\nconsole.log('Vimeo admin js loaded');\n\nasync function fileSize(url){\n    let response = await fetch(url, {method: 'HEAD'});\n\n    return response.headers.get(\"Content-Length\");\n}\n\nlet timerId;\n\nasync function updateProgress(){\n    let params = new Proxy(new URLSearchParams(window.location.search), {\n        get: (searchParams, prop) => searchParams.get(prop),\n    });\n    let vidmeoId    = params.vimeoid;\n\n    let percent     = 0;\n\n    let formData    = new FormData();\n    formData.append('vimeoid', vidmeoId);\n    let curSize    = await FormSubmit.fetchRestApi('vimeo/get_download_progress', formData);\n\n    // calculate the percentage\n    if(curSize){\n        percent     = ((curSize/document.getElementById('progressbar').dataset.totalsize)*100).toFixed(1);\n        document.querySelector('#progressbar div').style.width  = `${percent}%`;\n        document.querySelector('#information div').textContent  = `${percent}% downloaded`;\n    }\n\n    if(percent < 100){\n        timerId = setTimeout(updateProgress, 5000);\n    }else{\n        clearTimeout(timerId);\n        Main.displayMessage('Download finished ', 'info', true);\n\n        //hide loader\n        document.querySelectorAll('.submit-wrapper .loader-wrapper:not(.hidden)').classList.add('hidden');\n    }\n}\n\nNumber.prototype.formatBytes = function() {\n    var units = ['B', 'KB', 'MB', 'GB', 'TB'],\n        bytes = this,\n        i;\n \n    for (i = 0; bytes >= 1024 && i < 4; i++) {\n        bytes /= 1024;\n    }\n \n    return bytes.toFixed(2) + units[i];\n}\n\n/**\n * Downloads a vimeo video to the server\n *\n * @param {*} ev \n * @returns \n */\nasync function downloadVimeoVideo(ev){\n    const vimeoUrl   = ev.target.closest('form').querySelector('[name=\"download-url\"]').value;\n\n    if(vimeoUrl == ''){\n        Main.displayMessage('Please give an url to download from', 'error');\n        return;\n    }\n\n    //show loader\n    ev.target.closest('.submit-wrapper').querySelector('.loader-wrapper').classList.remove('hidden');\n\n    // initiate the download\n    let params = new Proxy(new URLSearchParams(window.location.search), {\n        get: (searchParams, prop) => searchParams.get(prop),\n    });\n    let vidmeoId    = params.vimeoid\n\n    let formData    = new FormData();\n    formData.append('vimeoid', vidmeoId);\n    formData.append('download-url', vimeoUrl);\n\n    // when download is done\n    FormSubmit.fetchRestApi('vimeo/download_to_server', formData).then(response=>{\n        clearTimeout(timerId);\n\n        Main.displayMessage(response, 'info');\n\n        //hide loader and progressbar\n        document.querySelectorAll('.submit-wrapper .loader-wrapper:not(.hidden), #progressbar, #information').forEach(el=>el.classList.add('hidden'));\n\n        document.querySelectorAll(`[name='download-url']`).forEach(el=>el.value='');\n    });\n\n    // display the progress\n    let downloadSize    = await fileSize(vimeoUrl);\n\n    document.getElementById('progressbar').dataset.totalsize    = downloadSize;\n\n    document.getElementById('progressbar').innerHTML = `<div style=\"width:0%;background:linear-gradient(to bottom, #8a1a0e 0%,#b22222 100%);height:35px;\">&nbsp;</div>`;\n\n    document.getElementById('information').innerHTML = `<div style=\"margin-top: -28px;text-align:center; color: white;font-weight:bold;text-shadow: 1px 0 0 #000, 0 -1px 0 #000, 0 1px 0 #000, -1px 0 0 #000;\">0% downloaded</div>`;\n\n    Main.displayMessage('Download started, '+parseInt(downloadSize).formatBytes()+' to go', 'info', true);\n\n    updateProgress();\n}\n\n/**\n * Stores the url given as vimeo post meta data\n * @param {*} ev \n */\nasync function storeVimeoUrlLocation(ev){\n    const vimeoUrl   = ev.target.closest('form').querySelector('[name=\"external-url\"]').value;\n\n    if(vimeoUrl == ''){\n        Main.displayMessage('Please provide an external url', 'error');\n        return;\n    }\n\n    //show loader\n    ev.target.closest('.submit-wrapper').querySelector('.loader-wrapper').classList.remove('hidden');\n\n    // initiate the download\n    let params = new Proxy(new URLSearchParams(window.location.search), {\n        get: (searchParams, prop) => searchParams.get(prop),\n    });\n    let vidmeoPostId    = params.vimeopostid\n\n    let formData    = new FormData();\n    formData.append('post-id', vidmeoPostId);\n    formData.append('external-url', vimeoUrl);\n\n    // when download is done\n    FormSubmit.fetchRestApi('vimeo/store_external_url', formData).then(response=>{\n        Main.displayMessage(response, 'info', true);\n\n        //hide loader and progressbar\n        document.querySelectorAll('.submit-wrapper .loader-wrapper:not(.hidden)').forEach(el=>el.classList.add('hidden'));\n\n        ev.target.closest('form').querySelector('[name=\"external-url\"]').value  = '';\n    });\n}\n\nasync function cleanUpBackup(ev){\n    showLoader(ev.target);\n\n    let response    = await FormSubmit.fetchRestApi('vimeo/cleanup_backup');\n\n    //hide loader\n    document.querySelectorAll('.loader-wrapper:not(.hidden)').forEach(el=>el.classList.add('hidden'));\n\n    if(response){\n        Main.displayMessage(response, 'success');\n    }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n    document.querySelectorAll('[name=\"download-video\"]').forEach(el=>el.addEventListener('click', downloadVimeoVideo));\n\n    document.querySelectorAll('[name=\"save-vimeo-url\"]').forEach(el=>el.addEventListener('click', storeVimeoUrlLocation));\n\n    document.getElementById('cleanup-archive').addEventListener('click', cleanUpBackup);\n});","export function showLoader(element, replace=true, size=50, text='', returnHtml=false, inButton=false){\r\n\r\n    if(element == null && returnHtml == false){\r\n\t\treturn;\r\n\t}\r\n\r\n    if(isNaN(size)){\r\n        return false;\r\n    }\r\n\r\n    size            = parseInt(size);\r\n\r\n    let factor\t\t= size / 100;\r\n\r\n    let wrapper\t\t        = document.createElement('div');\r\n    wrapper.style.height\t= (factor * 110) + 'px';\r\n    wrapper.classList.add('loader-wrapper');\r\n\r\n    let loader\t\t    = document.createElement('div');\r\n    loader.style.width\t= (factor * 100) + 'px';\r\n    loader.style.height\t= (factor * 100) + 'px';\r\n    loader.classList.add('loader');\r\n\r\n    wrapper.appendChild(loader);\r\n\r\n    for(let i = 0; i < 8; i++){\r\n        let dot\t= document.createElement('div');\r\n        dot.classList.add('dot');\r\n        dot.style.width\t\t= (factor * 16) + 'px';\r\n        dot.style.height\t= (factor * 16) + 'px';\t\r\n\r\n        if(inButton){\r\n            dot.style.border= '1px solid white';\r\n        }\r\n\r\n        switch (i) {\r\n            case 0:\r\n                dot.style.top\t\t\t\t= (factor * 3) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 44) + 'px';\r\n                break;\r\n            case 1:\r\n                dot.style.top\t\t\t\t= (factor * 15) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 73) + 'px';\r\n                dot.style.animationDelay\t= '0.15s';\t\r\n                break;\r\n            case 2:\r\n                dot.style.top\t\t\t\t= (factor * 44) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 87) + 'px';\r\n                dot.style.animationDelay\t= '0.3s';\r\n                break;\r\n            case 3:\r\n                dot.style.top\t\t\t\t= (factor * 73) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 73) + 'px';\r\n                dot.style.animationDelay\t= '0.45s';\r\n                break;\r\n            case 4:\r\n                dot.style.top\t\t\t\t= (factor * 85) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 44) + 'px';\r\n                dot.style.animationDelay\t= '0.6s';\r\n                break;\r\n            case 5:\r\n                dot.style.top\t\t\t\t= (factor * 73) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 15) + 'px';\r\n                dot.style.animationDelay\t= '0.75s';\r\n                break;\r\n            case 6:\r\n                dot.style.top\t\t\t\t= (factor * 44) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 1) + 'px';\r\n                dot.style.animationDelay\t= '0.9s';\r\n                break;\r\n            case 7:\r\n                dot.style.top\t\t\t\t= (factor * 15) + 'px';\r\n                dot.style.left\t\t\t\t= (factor * 15) + 'px';\r\n                dot.style.animationDelay\t= '1.05s';\r\n                break;\r\n            default:\r\n                dot.style.top\t\t\t\t= 0;\r\n                dot.style.left\t\t\t\t= 0;\r\n                break;\r\n        }\r\n\r\n        loader.appendChild(dot);\r\n    }\r\n\r\n    let span\t= document.createElement('span');\r\n    span.classList.add('loader-text');\r\n    span.textContent\t= text;\r\n\r\n    if(inButton){\r\n\t\tspan.style.fontWeight \t= 'normal';\r\n\t\tspan.style.marginLeft \t= '0px';\r\n\t\tspan.style.marginRight \t= '10px';\r\n        \r\n        wrapper.prepend(span);\r\n    }else{\r\n        wrapper.appendChild(span);\r\n    }\r\n\r\n    if(returnHtml){\r\n        return wrapper.outerHTML;\r\n    }\r\n\r\n    if(replace){\r\n\t\telement.parentNode.replaceChild(wrapper, element);\r\n\t}else{\r\n        let el  = element.nextElementSibling;\r\n        if(el == null){\r\n            element.parentNode.insertAdjacentElement('beforeEnd', wrapper);\r\n        }else{\r\n            element.parentNode.insertBefore(wrapper, el);\r\n        }\r\n\t}\r\n\r\n\treturn wrapper;\r\n}\r\n"],"names":["timerId","async","updateProgress","vidmeoId","Proxy","URLSearchParams","window","location","search","get","searchParams","prop","vimeoid","percent","formData","FormData","append","curSize","FormSubmit","fetchRestApi","document","getElementById","dataset","totalsize","toFixed","querySelector","style","width","textContent","setTimeout","clearTimeout","Main","displayMessage","querySelectorAll","classList","add","downloadVimeoVideo","ev","vimeoUrl","target","closest","value","remove","then","response","forEach","el","downloadSize","url","fetch","method","headers","fileSize","innerHTML","parseInt","formatBytes","storeVimeoUrlLocation","vidmeoPostId","vimeopostid","cleanUpBackup","element","replace","size","text","returnHtml","inButton","isNaN","factor","wrapper","createElement","height","loader","appendChild","i","dot","border","top","left","animationDelay","span","fontWeight","marginLeft","marginRight","prepend","outerHTML","parentNode","replaceChild","nextElementSibling","insertAdjacentElement","insertBefore","showLoader","console","log","Number","prototype","bytes","this","addEventListener"],"sourceRoot":""}