(()=>{"use strict";let e;async function t(){let a=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeoid,o=0,r=new FormData;r.append("vimeoid",a);let n=await FormSubmit.fetchRestApi("vimeo/get_download_progress",r);n&&(o=(n/document.getElementById("progressbar").dataset.totalsize*100).toFixed(1),document.querySelector("#progressbar div").style.width=`${o}%`,document.querySelector("#information div").textContent=`${o}% downloaded`),o<100?e=setTimeout(t,5e3):(clearTimeout(e),Main.displayMessage("Download finished ","info",!0),document.querySelectorAll(".submit-wrapper .loader-wrapper:not(.hidden)").classList.add("hidden"))}async function a(a){const o=a.target.closest("form").querySelector('[name="download-url"]').value;if(""==o)return void Main.displayMessage("Please give an url to download from","error");a.target.closest(".submit-wrapper").querySelector(".loader-wrapper").classList.remove("hidden");let r=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeoid,n=new FormData;n.append("vimeoid",r),n.append("download-url",o),FormSubmit.fetchRestApi("vimeo/download_to_server",n).then((t=>{clearTimeout(e),Main.displayMessage(t,"info"),document.querySelectorAll(".submit-wrapper .loader-wrapper:not(.hidden), #progressbar, #information").forEach((e=>e.classList.add("hidden"))),document.querySelectorAll("[name='download-url']").forEach((e=>e.value=""))}));let l=await async function(e){return(await fetch(e,{method:"HEAD"})).headers.get("Content-Length")}(o);document.getElementById("progressbar").dataset.totalsize=l,document.getElementById("progressbar").innerHTML='<div style="width:0%;background:linear-gradient(to bottom, #8a1a0e 0%,#b22222 100%);height:35px;">&nbsp;</div>',document.getElementById("information").innerHTML='<div style="margin-top: -28px;text-align:center; color: white;font-weight:bold;text-shadow: 1px 0 0 #000, 0 -1px 0 #000, 0 1px 0 #000, -1px 0 0 #000;">0% downloaded</div>',Main.displayMessage("Download started, "+parseInt(l).formatBytes()+" to go","info",!0),t()}async function o(e){const t=e.target.closest("form").querySelector('[name="external-url"]').value;if(""==t)return void Main.displayMessage("Please provide an external url","error");e.target.closest(".submit-wrapper").querySelector(".loader-wrapper").classList.remove("hidden");let a=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeopostid,o=new FormData;o.append("post-id",a),o.append("external-url",t),FormSubmit.fetchRestApi("vimeo/store_external-url",o).then((t=>{Main.displayMessage(t,"info",!0),document.querySelectorAll(".submit-wrapper .loader-wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),e.target.closest("form").querySelector('[name="external-url"]').value=""}))}async function r(e){!function(e,t=!0,a=50,o="",r=!1,n=!1){if(null==e&&0==r)return;if(!Number.isInteger(a))return!1;let l=a/100,s=document.createElement("div");s.style.height=110*l+"px",s.classList.add("loader-wrapper");let i=document.createElement("div");i.style.width=100*l+"px",i.style.height=100*l+"px",i.classList.add("loader"),s.appendChild(i);for(let e=0;e<8;e++){let t=document.createElement("div");switch(t.classList.add("dot"),t.style.width=16*l+"px",t.style.height=16*l+"px",n&&(t.style.border="1px solid white"),e){case 0:t.style.top=0,t.style.left=44*l+"px";break;case 1:t.style.top=14*l+"px",t.style.left=78*l+"px",t.style.animationDelay="0.15s";break;case 2:t.style.top=43*l+"px",t.style.left=88*l+"px",t.style.animationDelay="0.3s";break;case 3:t.style.top=74*l+"px",t.style.left=75*l+"px",t.style.animationDelay="0.45s";break;case 4:t.style.top=87*l+"px",t.style.left=44*l+"px",t.style.animationDelay="0.6s";break;case 5:t.style.top=74*l+"px",t.style.left=15*l+"px",t.style.animationDelay="0.75s";break;case 6:t.style.top=43*l+"px",t.style.left=0,t.style.animationDelay="0.9s";break;case 7:t.style.top=14*l+"px",t.style.left=15*l+"px",t.style.animationDelay="1.05s";break;default:t.style.top=0,t.style.left=0}i.appendChild(t)}let d=document.createElement("span");if(d.classList.add("loader-text"),d.textContent=o,n?(d.style.fontWeight="normal",d.style.marginLeft="0px",d.style.marginRight="10px",s.prepend(d)):s.appendChild(d),r)return s.outerHTML;if(t)e.parentNode.replaceChild(s,e);else{let t=e.nextElementSibling;null==t?e.parentNode.insertAdjacentElement("beforeEnd",s):e.parentNode.insertBefore(s,t)}}(e.target);let t=await FormSubmit.fetchRestApi("vimeo/cleanup_backup");document.querySelectorAll(".loader-wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),t&&Main.displayMessage(t,"success")}console.log("Vimeo admin js loaded"),Number.prototype.formatBytes=function(){var e,t=this;for(e=0;t>=1024&&e<4;e++)t/=1024;return t.toFixed(2)+["B","KB","MB","GB","TB"][e]},document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('[name="download-video"]').forEach((e=>e.addEventListener("click",a))),document.querySelectorAll('[name="save-vimeo-url"]').forEach((e=>e.addEventListener("click",o))),document.getElementById("cleanup-archive").addEventListener("click",r)}))})();
//# sourceMappingURL=admin.min.js.map