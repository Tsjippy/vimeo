(()=>{"use strict";let e;async function t(){let o=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeoid,n=0,r=new FormData;r.append("vimeoid",o);let a=await FormSubmit.fetchRestApi("vimeo/get_download_progress",r);a&&(n=(a/document.getElementById("progressbar").dataset.totalsize*100).toFixed(1),document.querySelector("#progressbar div").style.width=`${n}%`,document.querySelector("#information div").textContent=`${n}% downloaded`),n<100?e=setTimeout(t,5e3):(clearTimeout(e),Main.displayMessage("Download finished ","info",!0),document.querySelectorAll(".submit_wrapper .loadergif:not(.hidden)").classList.add("hidden"))}async function o(o){const n=o.target.closest("form").querySelector('[name="download_url"]').value;if(""==n)return void Main.displayMessage("Please give an url to download from","error");o.target.closest(".submit_wrapper").querySelector(".loadergif").classList.remove("hidden");let r=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeoid,a=new FormData;a.append("vimeoid",r),a.append("download_url",n),FormSubmit.fetchRestApi("vimeo/download_to_server",a).then((t=>{clearTimeout(e),Main.displayMessage(t,"info"),document.querySelectorAll(".submit_wrapper .loadergif:not(.hidden), #progressbar, #information").forEach((e=>e.classList.add("hidden"))),document.querySelectorAll("[name='download_url']").forEach((e=>e.value=""))}));let i=await async function(e){return(await fetch(e,{method:"HEAD"})).headers.get("Content-Length")}(n);document.getElementById("progressbar").dataset.totalsize=i,document.getElementById("progressbar").innerHTML='<div style="width:0%;background:linear-gradient(to bottom, #8a1a0e 0%,#b22222 100%);height:35px;">&nbsp;</div>',document.getElementById("information").innerHTML='<div style="margin-top: -28px;text-align:center; color: white;font-weight:bold;text-shadow: 1px 0 0 #000, 0 -1px 0 #000, 0 1px 0 #000, -1px 0 0 #000;">0% downloaded</div>',Main.displayMessage("Download started, "+parseInt(i).formatBytes()+" to go","info",!0),t()}async function n(e){const t=e.target.closest("form").querySelector('[name="external_url"]').value;if(""==t)return void Main.displayMessage("Please provide an external url","error");e.target.closest(".submit_wrapper").querySelector(".loadergif").classList.remove("hidden");let o=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeopostid,n=new FormData;n.append("post_id",o),n.append("external_url",t),FormSubmit.fetchRestApi("vimeo/store_external_url",n).then((t=>{Main.displayMessage(t,"info",!0),document.querySelectorAll(".submit_wrapper .loadergif:not(.hidden)").forEach((e=>e.classList.add("hidden"))),e.target.closest("form").querySelector('[name="external_url"]').value=""}))}async function r(e){!function(e,t=!0,o=""){if(null==e)return;let n=document.createElement("DIV");n.setAttribute("class","loaderwrapper"),""!=o&&(n.innerHTML=o);let r=document.createElement("IMG");if(r.setAttribute("class","loadergif"),r.setAttribute("src",sim.loadingGif),r.style.height="30px",n.insertAdjacentElement("beforeEnd",r),t)e.parentNode.replaceChild(n,e);else{let t=e.nextElementSibling;null==t?e.parentNode.insertAdjacentElement("beforeEnd",n):e.parentNode.insertBefore(n,t)}}(e.target);let t=await FormSubmit.fetchRestApi("vimeo/cleanup_backup");document.querySelectorAll(".loadergif:not(.hidden)").forEach((e=>e.classList.add("hidden"))),t&&Main.displayMessage(t,"success")}console.log("Vimeo admin js loaded"),Number.prototype.formatBytes=function(){var e,t=this;for(e=0;t>=1024&&e<4;e++)t/=1024;return t.toFixed(2)+["B","KB","MB","GB","TB"][e]},document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('[name="download_video"]').forEach((e=>e.addEventListener("click",o))),document.querySelectorAll('[name="save_vimeo_url"]').forEach((e=>e.addEventListener("click",n))),document.getElementById("cleanup-archive").addEventListener("click",r)}))})();
//# sourceMappingURL=admin.min.js.map