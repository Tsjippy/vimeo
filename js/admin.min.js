(()=>{"use strict";let e;async function t(){let o=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeoid,r=0,a=new FormData;a.append("vimeoid",o);let n=await FormSubmit.fetchRestApi("vimeo/get_download_progress",a);n&&(r=(n/document.getElementById("progressbar").dataset.totalsize*100).toFixed(1),document.querySelector("#progressbar div").style.width=`${r}%`,document.querySelector("#information div").textContent=`${r}% downloaded`),r<100?e=setTimeout(t,5e3):(clearTimeout(e),Main.displayMessage("Download finished ","info",!0),document.querySelectorAll(".submit_wrapper .loader_wrapper:not(.hidden)").classList.add("hidden"))}async function o(o){const r=o.target.closest("form").querySelector('[name="download_url"]').value;if(""==r)return void Main.displayMessage("Please give an url to download from","error");o.target.closest(".submit_wrapper").querySelector(".loader_wrapper").classList.remove("hidden");let a=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeoid,n=new FormData;n.append("vimeoid",a),n.append("download_url",r),FormSubmit.fetchRestApi("vimeo/download_to_server",n).then((t=>{clearTimeout(e),Main.displayMessage(t,"info"),document.querySelectorAll(".submit_wrapper .loader_wrapper:not(.hidden), #progressbar, #information").forEach((e=>e.classList.add("hidden"))),document.querySelectorAll("[name='download_url']").forEach((e=>e.value=""))}));let d=await async function(e){return(await fetch(e,{method:"HEAD"})).headers.get("Content-Length")}(r);document.getElementById("progressbar").dataset.totalsize=d,document.getElementById("progressbar").innerHTML='<div style="width:0%;background:linear-gradient(to bottom, #8a1a0e 0%,#b22222 100%);height:35px;">&nbsp;</div>',document.getElementById("information").innerHTML='<div style="margin-top: -28px;text-align:center; color: white;font-weight:bold;text-shadow: 1px 0 0 #000, 0 -1px 0 #000, 0 1px 0 #000, -1px 0 0 #000;">0% downloaded</div>',Main.displayMessage("Download started, "+parseInt(d).formatBytes()+" to go","info",!0),t()}async function r(e){const t=e.target.closest("form").querySelector('[name="external_url"]').value;if(""==t)return void Main.displayMessage("Please provide an external url","error");e.target.closest(".submit_wrapper").querySelector(".loader_wrapper").classList.remove("hidden");let o=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).vimeopostid,r=new FormData;r.append("post_id",o),r.append("external_url",t),FormSubmit.fetchRestApi("vimeo/store_external_url",r).then((t=>{Main.displayMessage(t,"info",!0),document.querySelectorAll(".submit_wrapper .loader_wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),e.target.closest("form").querySelector('[name="external_url"]').value=""}))}async function a(e){!function(e,t=!0){if(null==e)return;let o=document.createElement("DIV");if(o.innerHTML=sim.loaderHtml,t)e.parentNode.replaceChild(o,e);else{let t=e.nextElementSibling;null==t?e.parentNode.insertAdjacentElement("beforeEnd",o):e.parentNode.insertBefore(o,t)}}(e.target);let t=await FormSubmit.fetchRestApi("vimeo/cleanup_backup");document.querySelectorAll(".loader_wrapper:not(.hidden)").forEach((e=>e.classList.add("hidden"))),t&&Main.displayMessage(t,"success")}console.log("Vimeo admin js loaded"),Number.prototype.formatBytes=function(){var e,t=this;for(e=0;t>=1024&&e<4;e++)t/=1024;return t.toFixed(2)+["B","KB","MB","GB","TB"][e]},document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll('[name="download_video"]').forEach((e=>e.addEventListener("click",o))),document.querySelectorAll('[name="save_vimeo_url"]').forEach((e=>e.addEventListener("click",r))),document.getElementById("cleanup-archive").addEventListener("click",a)}))})();
//# sourceMappingURL=admin.min.js.map